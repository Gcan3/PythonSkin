<!DOCTYPE html>
<html lang="en" data-sidebar-color="light" data-topbar-color="light" data-sidebar-view="default">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyze Skin | SkinGuard</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="x-icon" href="static/img/skinguard-favicon.svg">

    <!-- CSS -->
    <link rel="stylesheet" href="static/css/icons.css">
    <link rel="stylesheet" href="static/css/style.css">

    <!-- Head JS -->
    <script src="static/js/head.js"></script>
</head>

<body>
    <!-- Wrapper -->
    <div class="app-wrapper">
        <!-- Menu Start -->
        <div class="app-menu">
            <!-- Logo -->
            <a href="{{ url_for('index') }}" class="logo-box">
                <img src="static/img/skinguard-logo-small.png">
            </a>
            <!--- Menu -->
            <div data-simplebar>
                <ul class="menu">
                    <li class="menu-title">MENU</li>

                    <li class="menu-item">
                        <a href="{{ url_for('index') }}" class="menu-link">
                            <span class="menu-icon"><i class="mdi mdi-home-outline"></i></span>
                            <span class="menu-text"> Home </span>
                        </a>
                    </li>

                    <li class="menu-item">
                        <a href="{{ url_for('analyze_skin') }}" class="menu-link">
                            <span class="menu-icon"><i class="mdi mdi-magnify"></i></span>
                            <span class="menu-text"> Analyze Skin </span>
                        </a>
                    </li>

                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <span class="menu-icon"><i class="mdi mdi-chart-bell-curve-cumulative"></i></span>
                            <span class="menu-text"> Skin Type </span>
                        </a>
                    </li>

                    <li class="menu-item">
                        <a href="#" class="menu-link">
                            <span class="menu-icon"><i class="mdi mdi-weather-sunny"></i></span>
                            <span class="menu-text"> UV Index </span>
                        </a>
                    </li>

                    <li class="menu-title">INFORMATION</li>

                    <li class="menu-item">
                        <a href="https://skinguard-information-center.notaku.site/" target="_blank" class="menu-link">
                            <span class="menu-icon"><i class="mdi mdi-information-outline"></i></span>
                            <span class="menu-text"> Information Center </span>
                        </a>
                    </li>

                    <li class="menu-item">
                        <a href="https://skinguard-knowledge-base.notaku.site/" target="_blank" class="menu-link">
                            <span class="menu-icon"><i class="mdi mdi-help"></i></span>
                            <span class="menu-text"> Help Center </span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Menu End -->

        <!-- Page Content Start -->
        <div class="app-content">

            <!-- Heading Bar Start -->
            <header class="app-header">

                <!-- Brand Logo -->
                <a href="{{ url_for('index') }}" class="logo-box">
                    <img src="static/img/skinguard-single-logo.svg" class="small-logo" alt="Small logo">
                </a>

                <!-- Menu Toggle Button -->
                <button id="button-toggle-menu" class="nav-link">
                    <span class="hamburger-nav"></span>
                    <span class="hamburger-nav-main">
                        <i class="mdi mdi-24px mdi-menu"></i>
                    </span>
                </button>

                <!-- Page Title -->
                <h4 class="header-font-title">Analyze Skin</h4>
            </header>
            <!-- Heading Bar End -->

            <!-- Main Content Start -->
            <main class="main-body">
                <!-- Upper Row -->
                <div class="main-grid-row xl-grid-4-cols m-grid-3-cols">

                
                    <!-- Skin Image Start -->
                    <div class="card card-skin-photo">
                        <div class="card-header flex justify-between items-center">
                            <h4 class="card-title">Upload Image</h4>
                        </div>

                        <div class="card-container">
                            <div class="input-group">
                                <!-- upload flask function -->
                                <form id="uploadForm" enctype="multipart/form-data">
                                    <input type="file" name="file" accept="image/*">
                                    <button type="submit" class="upload-button">Analyze Image</button>
                                </form>
                            </div>
                        </div>
                    </div>
            
                    <!-- Skin Image End -->
                
              <!-- Skin Image Start -->
<div id="imagePart" style="display: none;">
    <div class="card card-skin-photo">
        <div class="card-header flex justify-between items-center">
            <h4 class="card-title">Image</h4>
        </div>

        <div class="card-container">
            <img id="uploadedImage" class="img-card" src="" alt="">
        </div>
    </div>
</div>
<!-- Skin Image End -->

                    <!-- Skin Image End -->

                    <!-- Result Start -->
                    
                   <!-- Result Start -->
    <div class="results-row" id="results">
        <!-- Paste the content related to the diagnosis and accuracy here -->
        <div class="card card-diagnosis-table">
            <div class="card-header">
                <h4 class="card-title">Diagnosis</h4>
            </div>

            <div class="results-container">
                <div class="result-icon">
                    <span class="results-container icon">
                        <i class="mdi mdi-24px mdi-stethoscope"></i>
                    </span>
                    <span>
                        <span class="result-heading">Classification</span>
                        <span class="result-number" id="classification"><span></span></span>
                    </span>
                </div>

                <p class="result-description">A benign growth is <strong>non-cancerous</strong>,
                    typically develops slowly, and doesn't spread to other parts of the body.</p>
            </div>
        </div>

        <!-- ACCURACY RESULTS -->
        <div class="card card-diagnosis-table">
            <div class="card-header">
                <h4 class="card-title">Accuracy</h4>
            </div>

            <div class="results-container">
                <div class="result-icon">
                    <span class="results-container icon">
                        <i class="mdi mdi-24px mdi-percent-outline"></i>
                    </span>
                    <span>
                        <span class="result-heading">Accuracy Score</span>
                        <span class="result-number" id="accuracyScore"></span>%
                    </span>
                </div>

                <p class="result-description">Accuracy score is a a measure of how well the algorithm predicts whether a skin spot is benign or malignant</p>
            </div>
        </div>
    </div>
</div>
                    <!-- Result End -->
                </div>
            </main>

            <!-- JS -->
            <script src="static/js/jquery.js"></script>
            <script src="static/js/simplebar.js"></script>
            <script src="static/js/waves.js"></script>
            <script src="static/js/knob.js"></script>
            <script src="static/js/preline.js"></script>
            <script src="static/js/app.js"></script>

            <!-- Script for handling form submission -->
<!-- Paste this JavaScript code at the end of the <body> tag -->
    <script>
        document.getElementById("uploadForm").addEventListener("submit", function (event) {
            event.preventDefault();
            var formData = new FormData(this);
            analyzeImage(formData);
        });
    
        function analyzeImage(formData) {
            fetch("/upload", {
                method: "POST",
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    // Display the results section and "Image" part
                    document.getElementById("results").style.display = "block";
                    document.getElementById("imagePart").style.display = "block";
    
                    // Update the content of the "Image" part
                    document.getElementById("uploadedImage").src = URL.createObjectURL(formData.get('file'));
    
                    // Update the content of the results
                    document.getElementById("classification").innerText = data.result;
                    document.getElementById("accuracyScore").innerText = data.scaled_value;

                    let scaledValue;
                    if (data.scaled_value >= 0.001 && data.scaled_value <= 0.49) {
                        // Scale the value from 0.001-0.02 to 0-1 range relative to 0.02 as 100%
                        scaledValue = (data.scaled_value / 0.02) * 100;
                    } else if (data.scaled_value >= 0.5 && data.scaled_value <= 1) {
                        // Existing logic for 0.5-1 range (considering 0.5 as 0% and 1 as 100%)
                        scaledValue = (data.scaled_value - 0.5) / (1 - 0.5) * 100;
                    } 
                    // Round the scaled value before displaying
                    const roundedScaledValue = Math.round(scaledValue);
                    document.getElementById("accuracyScore").innerText = Number(roundedScaledValue);

                })
                .catch(error => console.error("Error:", error));
        }
    
        // Hide the results section and "Image" part initially
        document.getElementById("results").style.display = "none";
        document.getElementById("imagePart").style.display = "none";
    </script>
    
    
        </div>
        <!-- Page Content End -->
    </div>
    <!-- Wrapper End -->
</body>

</html>
